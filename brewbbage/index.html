<!DOCTYPE HTML>
<html>
<head>
  <title>Brewbbage</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="http://code.jquery.com/mobile/1.1.0/jquery.mobile-1.1.0.min.css" type="text/css" media="screen" charset="utf-8" />
  <link rel="app-manifest" href="manifest.webapp" />
  <script src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
  <script src="http://code.jquery.com/mobile/1.1.0/jquery.mobile-1.1.0.min.js"></script>
  <script src="https://raw.github.com/sdiehl/jquery-mathml/master/jquery_mathml.js"></script>
  <style type="text/css" media="screen">
    .highlight {
      color: green;
      border: 1px solid green;
    }
  </style>
</head>
<body>
  <div data-role="page">
    <div data-role="header">
      <h1 id="mash_water">Mash Water</h1>
    </div>
    <div data-role="content">
      <math display="block" id="equation">
      <mrow>
      <mstyle mathsize="120%">
        <mi id="strike_water_temp">Tw</mi>
        <mo>=</mo>
        <mo>(</mo>
        <mn id="const">.2</mn>
        <mo>/</mo>
        <mi id="ratio">1.25</mi>
        <mo>)</mo>
        <mo>&#xD7;</mo>
        <mo>(</mo>
        <mi class="target_temp">T2</mi>
        <mo>-</mo>
        <mi id="init_temp">T1</mi>
        <mo>)</mo>
        <mo>+</mo>
        <mi class="target_temp">T2</mi>
      </mstyle>
      </mrow>
      </math>
      <textarea name="variable_desc" id="variable_desc"></textarea>
      <div class="ui-field-contain ui-body ui-br var" data-role="fieldcontain" id="units_div">
        <label class="ui-input-text" for="units">Units:</label>
        <select name="units" data-role="slider" class="input">
          <option value="us">us</option>
          <option value="metric">metric</option>
        </select>
      </div>
      <div class="ui-field-contain ui-body ui-br var" data-role="fieldcontain" id="target_temp_div">
        <label class="ui-input-text" for="target_temp">Target Temp:</label>
        <input type="number" class="input" name="target_temp" min="0" value="" placeholder="Target Temp" />
      </div>
      <div class="ui-field-contain ui-body ui-br var" data-role="fieldcontain" id="init_temp_div">
        <label class="ui-input-text" for="init_temp">Initial Temp:</label>
        <input type="number" class="input" name="init_temp" min="0" value="72" placeholder="Initial Temp" />
      </div>
      <div class="ui-field-contain ui-body ui-br var" data-role="fieldcontain" id="ratio_div">
        <label class="ui-input-text" for="ratio">Ratio:</label>
        <input type="number" class="input" name="ratio" min="0" value="1.25" placeholder="Ratio" />
      </div>
    </div>
  </div>
  <script type="text/javascript" charset="utf-8">
    var thermo_const_us = .2;
    var thermo_const_metric = .41;
    var thermo_const = thermo_const_us;
    $('.var input').keyup(function(){
        if ($('select option:selected').val() == "us"){
          thermo_const = thermo_const_us;
        } else {
          thermo_const = thermo_const_metric;
        }
        var ratio = parseFloat($('input[name="ratio"]').val());
        var grain_amount = $('input[name="grain_amount"]').val();
        var target_temp = $('input[name="target_temp"]').val();
        var init_temp = $('input[name="init_temp"]').val();
        if (typeof(ratio) == "number") {
          $('#ratio').text(ratio);
        } else {
          $('#ratio').text('r');
        }
        if (target_temp) {
          $('.target_temp').text(target_temp);
        } else {
          $('.target_temp').text('T2');
        }
        if (init_temp) {
          $('.init_temp').text(init_temp);
        } else {
          $('.init_temp').text('T1');
        }
        var strike_temp = parseFloat((thermo_const/ratio)*(target_temp - init_temp) + parseFloat(target_temp));
        if (typeof(strike_temp) == "number") {
          strike_temp = strike_temp.toFixed(1);
          $('#strike_water_temp').text(strike_temp);
        } else {
          $('#strike_water_temp').text('Tw');
        }
    });
    var varDesc = {
      "units": "http://www.howtobrew.com/section3/chapter16-3.html",
      "target": "http://www.howtobrew.com/section3/chapter16-3.html",
      "init": "http://www.howtobrew.com/section3/chapter16-3.html",
      "ratio": "http://www.howtobrew.com/section3/chapter16-3.html"
    };
    function initHighlightVar(div, mathEl, descKey) {
      $(div).hover(function(){
          $(mathEl).addClass('highlight');
          $('#variable_desc').val(varDesc[descKey]);
        },
        function(){
          $(mathEl).removeClass('highlight');
          $('#variable_desc').val('');
      });
    }
    initHighlightVar('#units_div', '#const', 'units');
    initHighlightVar('#target_temp_div', '.target_temp', 'target');
    initHighlightVar('#init_temp_div', '#init_temp', 'init');
    initHighlightVar('#ratio_div', '#ratio', 'ratio');
  </script>
</body>
</html>
